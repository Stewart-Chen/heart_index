:root{
  --bg:#adc3cc; --card:#121a2b; --muted:#9bb0d3; --text:#eaf2ff;
  --accent:#59d1c5; --accent-2:#7aa6ff; --grid:#24314d;
  --brand:#1bb1c9;
}

@media (prefers-color-scheme: light){
  :root{
    --bg:#f6f9ff; --card:#ffffff; --muted:#5b6f93; --text:#0c1b34;
    --accent:#00b8a9; --accent-2:#3a6cf0; --grid:#e5ecfa;
  }
}

@media (prefers-color-scheme: dark){
  :root{
    --bg:#0b1320; --card:#121a2b; --text:#eaf2ff; --muted:#9bb0d3;
    --accent:#59d1c5; --accent-2:#7aa6ff; --grid:#24314d;
  }
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Noto Sans TC,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
  background:var(--bg);
  color:var(--text);
}

header{
  padding:24px 18px;
  display:flex; flex-wrap:wrap; align-items:flex-start; gap:16px;
  position:sticky; backdrop-filter:saturate(140%) blur(6px);
}

.logo{display:flex;align-items:center;gap:10px;font-weight:700;font-size:16px}
.logo .logo-img{
  width:50px; height:50px; border-radius:8px; object-fit:contain;
}

.pill{padding:8px 12px; border:1px solid #ffffff26; border-radius:999px; color:var(--muted); font-size:12px}
.wrap{max-width:1160px;margin:0 auto;padding:0 18px 48px}
.tab{padding:10px 14px; border-radius:10px; background:#cda15029; color:#0a1320; border:1px solid #ffffff24; cursor:pointer; user-select:none; font-weight:600}
.tab.active{background:linear-gradient(135deg,var(--brand), #52d09b); border-color:#6de3c2aa}
.grid{display:grid; gap:18px; grid-template-columns:1.2fr .8fr}
@media (max-width:980px){.grid{grid-template-columns:1fr}}
.card{background:var(--card); border:1px solid #ffffff14; border-radius:16px; padding:18px; box-shadow:0 10px 30px #00000025}
h1,h2,h3{margin:6px 0 8px} h1{font-size:28px} h2{font-size:20px} h3{font-size:16px;color:var(--muted)}
.kpis{display:grid;grid-template-columns:repeat(4,1fr);gap:12px} 
@media (max-width:700px){.kpis{grid-template-columns:repeat(2,1fr)}}
.kpi{background:#ffffff0d;padding:12px;border:1px solid #ffffff14;border-radius:12px}
.kpi .v{font-size:22px;font-weight:800} .kpi .l{font-size:12px;color:var(--muted)}
.tbl{width:100%;border-collapse:collapse;font-size:14px}
.tbl th,.tbl td{padding:10px;border-bottom:1px solid #ffffff14;vertical-align:top}
.muted{color:var(--muted)}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:flex-start}
.input{display:flex;flex-direction:column;gap:6px;background:#306c971f;padding:12px;border-radius:12px;border:1px solid #ffffff14}
.input label{font-size:12px;color:var(--muted)}
.input input,.input textarea{padding:8px;border-radius:8px;border:1px solid #ffffff24;background:#433c821f;color:var(--text);min-width:140px}
.input textarea{min-height:44px}
.btn{padding:10px 14px;border-radius:10px;background:linear-gradient(135deg,var(--brand),#52d09b); color:#0a1320;font-weight:800;border:none;cursor:pointer}
.btn.secondary{background:#cda15029;color:var(--text);border:1px solid #ffffff24}
.btn.xs{padding:6px 10px;border-radius:8px;font-size:12px}
canvas{width:100%;height:auto;max-height:460px;display:block}
.legend{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
.dot{width:10px;height:10px;border-radius:999px;display:inline-block;margin-right:6px}
.tag{font-size:12px;color:var(--muted);padding:6px 8px;border:1px solid #ffffff24;border-radius:999px}
.mini{font-size:12px;color:var(--muted)}
.panel{display:none}
.panel.active{display:block}
.subhead{font-weight:700;margin-top:6px;margin-bottom:2px;color:var(--muted)}
.line{display:flex;gap:8px;flex-wrap:wrap;align-items:center}

/* —— 長條圖（螢幕＋PDF 共用） —— */
.barlist{
  --label:100px; --value:60px;
  --track:#ffffff1a; --track-b:#ffffff26; --fill1:var(--brand); --fill2:#52d09b;
  display:grid; grid-template-columns:var(--label) minmax(0,1fr) var(--value);
  gap:6px 10px; align-items:center; font-size:14px;
}  
.barname{justify-self:end; color:var(--muted)}
.bartrack{height:10px; border-radius:6px; background:var(--track); border:1px solid var(--track-b); overflow:hidden}
.barfill{height:100%; background:linear-gradient(90deg,var(--fill1),var(--fill2))}
.barpct{ justify-self:end; color:var(--muted); font-variant-numeric:tabular-nums; white-space:nowrap; }

footer{opacity:.7;text-align:center;font-size:12px;padding:30px 10px}

/* 螢幕＋PDF 共用：雙向長條 */
.bartrack.signed{ position:relative }
.bartrack.signed::after{
  content:''; position:absolute; left:50%; top:-1px; bottom:-1px; width:1px;
  background: var(--track-b);
}
.barfill-pos, .barfill-neg{ position:absolute; height:100% }
.barfill-pos{ left:50%; background: linear-gradient(90deg,var(--fill1),var(--fill2)); }
.barfill-neg{ right:50%; background: linear-gradient(90deg,#ffb3b3,#ff6b6b); }

/* ====== 列印（PDF 美化） ====== */
@media print{
  @page{ size:A4; margin:10mm }
  body{ background:#fff; color:#000 }
  header, #webOnly{ display:none !important }

  .print-container{
    position:absolute; inset:0; width:100%;
    -webkit-print-color-adjust:exact; print-color-adjust:exact;
  }

  :root{
    --page-pad-x:4mm;
    --footer-reserve:12mm;
    --print-height: calc(297mm - 2 * 10mm);
  }

  #p2 #pl1{ padding-bottom: 16mm !important }

  .page{
    position:relative; min-height:var(--print-height);
    box-sizing:border-box;
    padding:0 var(--page-pad-x) calc(var(--footer-reserve) + 1mm) var(--page-pad-x);
    background:#fff;
  }
  .page:not(:last-child){ page-break-after:always }

  .ph{
    font-size:11px; color:#777; letter-spacing:.3px;
    display:flex; justify-content:space-between; align-items:center;
    border-bottom:1px solid #e6e6e6; padding:2mm 0;
  }
  .pfooter{
    position:absolute; left:var(--page-pad-x); right:var(--page-pad-x); bottom:0;
    font-size:10px; color:#888; border-top:1px solid #eee;
    padding-top:2mm; margin-top:0; background:#fff;
  }

  .ptitle{ font-size:22px; font-weight:800; margin:4mm 0 2mm }
  .psub{ color:#333; margin:0 0 3mm }
  .pcard{ border:1px solid #e6e6e6; border-radius:6px; padding:3mm; background:#fff }
  .kpis.print{ grid-template-columns:repeat(4,1fr); gap:6mm }
  .legend .dot{ border:1px solid #0003 }
  .section-title{ font-weight:800; margin:4mm 0 2mm; border-left:4px solid var(--brand); padding-left:3mm }
  .small{ font-size:12.5px; color:#333; line-height:1.7 }
  .radarPrint{ width:178mm; height:88mm; display:block; margin:2mm 0 1mm }
  .barlist{ --track:#f2f5ff; --track-b:#dfe6fb; --fill1:var(--brand); --fill2:#36c6b4 }

  #p1{ --brand-ink: var(--brand, #1bb1c9); --ink:#222; --mut:#666; --line:#eaeaea }

  #p1 .cover-grid{
    display:grid; grid-template-columns:1.2fr .8fr;
    column-gap:6mm; row-gap:4mm; align-items:start;
    margin:6mm 0 4mm; min-height:auto;
  }
  @media print and (max-width:190mm){ #p1 .cover-grid{ grid-template-columns:1fr } }

  #p1 .cover-grid > div:first-child{
    display:flex; flex-direction:column; justify-content:flex-start;
    gap:3mm; min-height:auto;
  }

  #p1 .brand-row{ display:flex; align-items:center; gap:4mm; margin:0 0 4mm }
  #p1 .brand-logo, #p1 #pcolorSVG{ width:18mm; height:18mm; border-radius:4px }
  #p1 .brand-logo{ object-fit:contain }
  #p1 .badge{
    display:inline-block; margin-left:auto; padding:1.6mm 2.8mm;
    border-radius:999px; font-weight:700; font-size:10.5px;
    background:linear-gradient(135deg,var(--brand-ink),#52d09b); color:#0a1320;
  }

  #p1 .brand-chip{
    display:inline-flex; align-items:center; gap:2mm; margin-right:2.4mm;
    padding:1.6mm 2.6mm; border:1px solid var(--line); border-radius:999px;
    font-size:10.5px; color:#333; background:#fff;
  }

  #p1 .ptitle{ font-size:26px; font-weight:900; line-height:1.25; margin:1.5mm 0 1.5mm !important }
  #p1 .psub{ font-size:12.5px; color:var(--mut); margin:0 0 3mm !important; max-width:165mm }

  #p1 .kpi-rail{
    display:grid; grid-template-columns:repeat(2,1fr);
    grid-auto-rows:minmax(16mm,auto); gap:3.2mm; align-content:start;
  }
  #p1 .kpi-rail .kpi{
    display:flex; flex-direction:column; gap:1mm;
    padding:3mm; border:1px solid var(--line); border-radius:8px; background:#fff;
  }
  #p1 .kpi-rail .kpi .v{ font-size:17px; font-weight:800; color:#000 }
  #p1 .kpi-rail .kpi .l{ font-size:10.5px; color:#667 }

  #p1ExpTitle, #p1Exp{ grid-column:1 / -1; display:block }
  #p1ExpTitle{ text-align:center; margin-top:10mm !important; margin-bottom:2mm }
  #p1Exp{
    max-width:178mm; margin:0 auto; line-height:1.7; padding:3.5mm 4mm;
  }

  #p1 .cover-grid{ margin-bottom:8mm !important }

  #p1Exp .exp-summary{
    display:flex; flex-wrap:wrap; gap:3mm; margin:2mm 0;
  }
  #p1Exp .exp-chip{
    border:1px solid #e6e6e6; border-radius:999px;
    padding:1.4mm 3mm; font-weight:700; background:#fff;
  }
  #p1Exp .divider{ height:1px; background:#eaeaea; margin:2.5mm 0 }
  #p1Exp .bartrack{ height:12px }

  .ph .ph-logo{ width:4.2mm; height:4.2mm; object-fit:contain; vertical-align:middle; border-radius:1mm; margin-right:2mm }
  .ph .ph-logo-fallback{
    display:inline-block; width:4.2mm; height:4.2mm;
    border-radius:1mm; margin-right:1mm;
    background:linear-gradient(135deg,var(--brand),#52d09b);
  }

  .bartrack.signed::after{ background:#dfe6fb }
  .barfill-pos{ background:linear-gradient(90deg,var(--brand),#36c6b4) }
  .barfill-neg{ background:linear-gradient(90deg,#f7b8b8,#ef7676) }

  header, #webOnly, main, footer { display:none !important }
  .print-container{ display:block !important; position:static !important }
  html, body{ height:auto !important; overflow:visible !important }

  #p1Exp .barlist{
    width:100%; max-width:none;
    --label:28mm; --value:20mm;
    margin:1.6mm auto 0;
  }
  #p1Exp .bartrack{ height:12px }
  .barpct{ white-space:nowrap }
}
