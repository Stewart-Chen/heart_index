<!DOCTYPE html><html lang="zh-Hant"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>心聚指標報告｜Lite（單場）</title>
<link rel="stylesheet" href="assets/common.css">
</head><body>
<header class="wrap" id="webOnly">
  <div class="logo"><span class="mark"></span><span id="brandName">心聚坊 HeartHub Studio</span></div>
  <span class="pill">Lite（單場）</span><div style="flex:1"></div>
  <a class="tab" href="pro.html">Pro</a><a class="tab" href="enterprise.html">Enterprise</a>

  <div style="flex-basis:100%;height:0"></div>
  <div class="row">
    <div class="input"><label>公司名稱</label><input id="company" value="心聚坊 HeartHub Studio"></div>
    <div class="input"><label>專案代號</label><input id="project" placeholder="例：HH-2025-Q3"></div>
    <div class="input"><label>報告日期</label><input id="rdate" type="date"></div>
    <div class="input"><label>Logo URL</label><input id="logoUrl"></div>
    <div class="input"><label>品牌色</label><input id="brandColor" type="color" value="#1bb1c9"></div>
    <div class="input"><label>聯絡信箱</label><input id="contactEmail" value="support@example.com"></div>
    <button class="btn" id="apply">套用內容</button>
    <button class="btn secondary" id="print">輸出 PDF</button>
  </div>

  <div class="panel active" style="flex-basis:100%">
    <div class="subhead">指標 Δ 與 KPI</div>
    <div class="row">
      <div class="input"><label>穩定度 Δ</label><input id="v_stable" type="number" step="0.1" value="0.8"></div>
      <div class="input"><label>壓力復原 Δ</label><input id="v_res" type="number" step="0.1" value="1.1"></div>
      <div class="input"><label>社會連結 Δ</label><input id="v_social" type="number" step="0.1" value="0.9"></div>
      <div class="input"><label>專注力 Δ</label><input id="v_focus" type="number" step="0.1" value="0.6"></div>
      <div class="input"><label>72h 維持率</label><input id="hold" value="76%"></div>
      <div class="input"><label>NPS</label><input id="nps" value="+68"></div>
      <div class="input"><label>學員數</label><input id="learners" type="number" value="28"></div>
    </div>

    <div class="subhead">學員一句話（每行一則）</div>
    <div class="row"><div class="input" style="min-width:420px">
      <textarea id="quotes">很久沒有這麼放鬆了
和同事一起畫畫很開心
壓力真的有緩解</textarea></div></div>

    <div class="subhead">行動採納（72h）</div>
    <div class="row" id="actionsWrap" style="gap:10px;flex-direction:column"></div>
    <button class="btn xs" id="addAction">+ 新增一項</button>

    <div class="subhead">關係圈擴散</div>
    <div class="row" id="rippleWrap" style="gap:10px;flex-direction:column"></div>
    <button class="btn xs" id="addRipple">+ 新增一項</button>

    <div class="subhead">下一步建議（每行一點）</div>
    <div class="row"><div class="input" style="min-width:420px">
      <textarea id="next">下載「家庭挑戰包」
老師優化教學清晰度（平均 4.3/5）
企業導入季度方案</textarea></div></div>
    <div class="mini">※ 按「套用內容」即可同步更新與列印。</div>
  </div>
</header>

<main class="wrap">
  <div class="grid">
    <section class="card">
      <h2>Lite 成效報告</h2><h3 class="muted">單場即時｜課前 vs 課後 Δ</h3>
      <div class="kpis" id="kpis"></div>
    </section>
    <aside class="card"><h2>操作小抄</h2>
      <ul class="muted" style="line-height:1.6">
        <li>本頁只含 Lite 欄位，Pro/Enterprise 於各自頁面設定。</li>
        <li>PDF 的雷達圖以 PNG 固定尺寸嵌入，避免跑版。</li>
      </ul>
    </aside>
  </div>

  <section class="grid" style="margin-top:18px">
    <section class="card">
      <h2>雷達圖①｜心聚四指標</h2>
      <canvas id="radar1"></canvas><div class="legend" id="legend1"></div>
    </section>
    <section class="card">
      <h2>雷達圖②｜Plutchik 八大情緒（由四指標投影）</h2>
      <canvas id="radar2"></canvas><div class="legend" id="legend2"></div>
    </section>
  </section>

  <section class="card" style="margin-top:18px">
    <h2 id="tbl_title">Lite｜重點表</h2>
    <table class="tbl" id="tbl"></table>
  </section>
</main>

<footer>© <span id="footBrand">心聚坊 HeartHub Studio</span></footer>

<script src="assets/common.js"></script>
<script>
const { $, $$, parseLines, clamp, kpiHTML, legendHTML, listHTML, barsHTML,
        indicatorsToPlutchik, drawRadar, printNow } = Common;

const state = {
  brand:{company:'心聚坊 HeartHub Studio',project:'',date:'',logoUrl:'',color:'#1bb1c9',contact:'support@example.com'},
  deltas:{stable:0.8,res:1.1,social:0.9,focus:0.6},
  kpi:{hold:'76%', nps:'+68', learners:28},
  quotes:['很久沒有這麼放鬆了','和同事一起畫畫很開心','壓力真的有緩解'],
  actions:[{name:'呼吸練習',pct:62},{name:'園藝照護',pct:54},{name:'藝術塗鴉',pct:38},{name:'感謝同事',pct:22}],
  ripple:[{name:'個人',pct:58},{name:'家人',pct:46},{name:'同事',pct:33},{name:'社團',pct:18}],
  next:['下載「家庭挑戰包」','老師優化教學清晰度（平均 4.3/5）','企業導入季度方案'],
  exports:{}
};

function rowInput(name='',pct=0,idx,type){return `
  <div class="row" data-type="${type}" data-idx="${idx}" style="align-items:center">
    <div class="input"><label>名稱</label><input data-k="name" value="${Common.esc(name)}"></div>
    <div class="input"><label>%</label><input data-k="pct" type="number" min="0" max="100" value="${pct}"></div>
    <button class="btn secondary xs" data-action="del">刪除</button>
  </div>`;}

function renderDynamic(){
  $('#actionsWrap').innerHTML = state.actions.map((x,i)=>rowInput(x.name,x.pct,i,'actions')).join('');
  $('#rippleWrap').innerHTML  = state.ripple .map((x,i)=>rowInput(x.name,x.pct,i,'ripple' )).join('');
}
function captureDynamic(){
  state.actions = $$('#actionsWrap .row').map(r=>({name:r.querySelector('[data-k="name"]').value.trim()||'—',
                                                   pct:parseInt(r.querySelector('[data-k="pct"]').value||0,10)}));
  state.ripple  = $$('#rippleWrap .row' ).map(r=>({name:r.querySelector('[data-k="name"]').value.trim()||'—',
                                                   pct:parseInt(r.querySelector('[data-k="pct"]').value||0,10)}));
}

function render(){
  // KPI
  const d=state.deltas;
  $('#kpis').innerHTML = kpiHTML([
    {l:"平均 Δ",v:((d.stable+d.res+d.social+d.focus)/4).toFixed(2)},
    {l:"72h 維持率",v:state.kpi.hold},
    {l:"NPS",v:state.kpi.nps},
    {l:"學員數",v:String(state.kpi.learners)}
  ]);

  // 表格
  $('#tbl').innerHTML = `<tr><th>項目</th><th>內容</th></tr>
    <tr><td>四指標 Δ</td><td class="muted">穩定度 ${d.stable.toFixed(1)}｜壓力復原 ${d.res.toFixed(1)}｜社會連結 ${d.social.toFixed(1)}｜專注力 ${d.focus.toFixed(1)}</td></tr>
    <tr><td>行動採納（72h）</td><td>${barsHTML(state.actions)}</td></tr>
    <tr><td>關係圈擴散</td><td>${barsHTML(state.ripple)}</td></tr>
    <tr><td>下一步建議</td><td>${listHTML(state.next)}</td></tr>
    <tr><td>學員一句話</td><td>${state.quotes.length? `<ul style="margin:0;padding-left:18px">${state.quotes.map(s=>`<li>「${Common.esc(s)}」</li>`).join('')}</ul>`:'（尚未填寫）'}</td></tr>`;

  // 雷達（畫在頁面上）
  const labels1=["穩定度","壓力復原","社會連結","專注力"];
  const ds1=[{label:"本場 Δ",color:"#59d1c5",values:[d.stable,d.res,d.social,d.focus],fill:.18}];
  state.exports.radar1 = drawRadar($('#radar1'),labels1,ds1,{padding:70});
  $('#legend1').innerHTML = legendHTML(ds1);

  const em = indicatorsToPlutchik(state.deltas);
  const labels2=Object.keys(em); const ds2=[{label:"情緒強度",color:"#7aa6ff",values:Object.values(em),fill:.18}];
  state.exports.radar2 = drawRadar($('#radar2'),labels2,ds2,{padding:80});
  $('#legend2').innerHTML = legendHTML(ds2);

  renderDynamic();
}

// 事件
document.addEventListener('click', (e)=>{
  if(e.target.id==='addAction'){ state.actions.push({name:`項目${state.actions.length+1}`,pct:0}); renderDynamic(); }
  if(e.target.id==='addRipple'){ state.ripple.push({name:`關係${state.ripple.length+1}`,pct:0}); renderDynamic(); }
  if(e.target.dataset.action==='del'){
    const row = e.target.closest('.row'); const type=row.dataset.type; const idx=+row.dataset.idx;
    state[type].splice(idx,1); renderDynamic();
  }
});

$('#apply').addEventListener('click', ()=>{
  // 品牌
  state.brand.company=$('#company').value||state.brand.company;
  state.brand.project=$('#project').value||'';
  state.brand.date=$('#rdate').value||'';
  state.brand.logoUrl=$('#logoUrl').value||'';
  state.brand.color=$('#brandColor').value||state.brand.color;
  state.brand.contact=$('#contactEmail').value||state.brand.contact;
  document.documentElement.style.setProperty('--brand', state.brand.color);
  $('#brandName').textContent = state.brand.company;
  $('#footBrand').textContent = state.brand.company;

  // Lite 值
  state.deltas.stable=parseFloat($('#v_stable').value||state.deltas.stable);
  state.deltas.res   =parseFloat($('#v_res').value||state.deltas.res);
  state.deltas.social=parseFloat($('#v_social').value||state.deltas.social);
  state.deltas.focus =parseFloat($('#v_focus').value||state.deltas.focus);
  state.kpi.hold = $('#hold').value||state.kpi.hold;
  state.kpi.nps  = $('#nps').value||state.kpi.nps;
  state.kpi.learners = parseInt($('#learners').value||state.kpi.learners,10);
  state.quotes = parseLines($('#quotes').value);
  state.next   = parseLines($('#next').value);

  captureDynamic();
  render();
});

$('#print').addEventListener('click', ()=>{
  const kpiHtml = $('#kpis').innerHTML;
  const tableTitle = $('#tbl_title').textContent;

  // 準備雷達設定（交給 common.js 在 PDF 內頁 canvas 重畫）
  const r1 = {
    labels:["穩定度","壓力復原","社會連結","專注力"],
    datasets:[{label:"本場 Δ",color:"#59d1c5",values:[state.deltas.stable,state.deltas.res,state.deltas.social,state.deltas.focus],fill:.18}],
    options:{padding:110, fontPx:18}
  };
  const em = indicatorsToPlutchik(state.deltas);
  const r2 = {
    labels:Object.keys(em),
    datasets:[{label:"情緒強度",color:"#7aa6ff",values:Object.values(em),fill:.18}],
    options:{padding:120, fontPx:18}
  };

  Common.printNow('lite', state.brand, kpiHtml, tableTitle, null, {
    tableNode: $('#tbl'),                 // 讓列印自動過濾重複列
    radar1: r1, radar2: r2,              // 內頁 canvas 重畫
    legend1HTML: $('#legend1').innerHTML,
    legend2HTML: $('#legend2').innerHTML,
    suggestionsHTML: Common.listHTML(state.next),
    quotesHTML: state.quotes.length? `<ul style="margin:0;padding-left:18px">${state.quotes.map(s=>`<li>「${Common.esc(s)}」</li>`).join('')}</ul>`:'（尚未填寫）',
    actionsHTML: barsHTML(state.actions),
    rippleHTML:  barsHTML(state.ripple)
  });
});

document.addEventListener('DOMContentLoaded', ()=>{
  $('#rdate').value = new Date().toISOString().slice(0,10);
  render();
});
</script>

</body></html>

