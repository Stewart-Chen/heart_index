<!DOCTYPE html><html lang="zh-Hant"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>心聚指標報告｜Pro（季度）</title>
<link rel="stylesheet" href="assets/common.css">
</head><body>
<header class="wrap" id="webOnly">
  <div class="logo"><span class="mark"></span><span id="brandName">心聚坊 HeartHub Studio</span></div>
  <span class="pill">Pro（季度）</span><div style="flex:1"></div>
  <a class="tab" href="index.html">Lite</a><a class="tab" href="enterprise.html">Enterprise</a>

  <div style="flex-basis:100%;height:0"></div>
  <div class="row">
    <div class="input"><label>公司名稱</label><input id="company" value="心聚坊 HeartHub Studio"></div>
    <div class="input"><label>專案代號</label><input id="project"></div>
    <div class="input"><label>報告日期</label><input id="rdate" type="date"></div>
    <div class="input"><label>Logo URL</label><input id="logoUrl"></div>
    <div class="input"><label>品牌色</label><input id="brandColor" type="color" value="#1bb1c9"></div>
    <div class="input"><label>聯絡信箱</label><input id="contactEmail" value="support@example.com"></div>
    <button class="btn" id="apply">套用內容</button>
    <button class="btn secondary" id="print">輸出 PDF</button>
  </div>

  <div class="panel active" style="flex-basis:100%">
    <div class="subhead">KPI</div>
    <div class="row">
      <div class="input"><label>場次</label><input id="sessions" type="number" value="8"></div>
      <div class="input"><label>學員數</label><input id="learners" type="number" value="172"></div>
      <div class="input"><label>平均 Δ</label><input id="avgDelta" value="+0.85"></div>
      <div class="input"><label>平均 NPS</label><input id="avgNPS" value="+65"></div>
    </div>

    <div class="subhead">部門數量與設定</div>
    <div class="row"><div class="input"><label>要比較幾個部門</label><input id="deptCount" type="number" min="1" max="6" value="3"></div></div>
    <div class="row" id="deptWrap" style="gap:14px;flex-direction:column"></div>

    <div class="subhead">建議處方（每行一點）</div>
    <div class="row"><div class="input" style="min-width:420px"><textarea id="suggestions">
強化業務部：專注力模組
持續推廣園藝挑戰包（高轉化）
</textarea></div></div>
  </div>
</header>

<main class="wrap">
  <div class="grid">
    <section class="card">
      <h2>Pro 季度報告</h2><h3 class="muted">季度趨勢｜部門比較</h3>
      <div class="kpis" id="kpis"></div>
    </section>
    <aside class="card"><h2>操作小抄</h2>
      <ul class="muted" style="line-height:1.6">
        <li>部門可 1–6 個，雷達與表格即時反映。</li>
      </ul>
    </aside>
  </div>

  <section class="grid" style="margin-top:18px">
    <section class="card"><h2>雷達圖①｜心聚四指標</h2>
      <canvas id="radar1"></canvas><div class="legend" id="legend1"></div></section>
    <section class="card"><h2>雷達圖②｜Plutchik 八大情緒（由四指標投影）</h2>
      <canvas id="radar2"></canvas><div class="legend" id="legend2"></div></section>
  </section>

  <section class="card" style="margin-top:18px">
    <h2 id="tbl_title">Pro｜部門比較</h2>
    <table class="tbl" id="tbl"></table>
  </section>
</main>

<footer>© <span id="footBrand">心聚坊 HeartHub Studio</span></footer>

<script src="assets/common.js"></script>
<script>
const { $, $$, parseLines, parseFour, kpiHTML, legendHTML, listHTML,
        indicatorsToPlutchik, drawRadar, printNow, pickColor, avg, esc } = Common;

const state = {
  brand:{company:'心聚坊 HeartHub Studio',project:'',date:'',logoUrl:'',color:'#1bb1c9',contact:'support@example.com'},
  kpi:{sessions:8, learners:172, avgDelta:'+0.85', avgNPS:'+65'},
  depts:[
    {name:'行政部', values:[1.1,1.2,1.0,0.8], hot:'呼吸練習'},
    {name:'業務部', values:[0.6,0.7,0.5,0.6], hot:'感恩挑戰'},
    {name:'研發部', values:[0.9,1.0,0.8,0.7], hot:'園藝挑戰'}
  ],
  suggestions:['強化業務部：專注力模組','持續推廣園藝挑戰包（高轉化）'],
  exports:{}
};

function buildDeptRows(){
  const n = Math.min(6, Math.max(1, parseInt($('#deptCount').value||3,10)));
  $('#deptCount').value=n;
  while(state.depts.length<n) state.depts.push({name:`部門${state.depts.length+1}`,values:[0.8,0.9,0.8,0.7],hot:'—'});
  state.depts = state.depts.slice(0,n);
  $('#deptWrap').innerHTML = state.depts.map((d,i)=>`
    <div class="row dept" data-idx="${i}" style="border:1px dashed #ffffff24;border-radius:10px;padding:10px">
      <div class="input"><label>部門名稱</label><input data-k="name" value="${esc(d.name)}"></div>
      <div class="input"><label>Δ 值（四項, 逗點）</label><input data-k="values" value="${d.values.join(',')}"></div>
      <div class="input"><label>熱門行動</label><input data-k="hot" value="${esc(d.hot)}"></div>
    </div>`).join('');
}
function captureDeptRows(){
  state.depts = $$('#deptWrap .dept').map((r,i)=>({
    name:r.querySelector('[data-k="name"]').value||`部門${i+1}`,
    values: parseFour(r.querySelector('[data-k="values"]').value,[0.8,0.9,0.8,0.7]),
    hot:r.querySelector('[data-k="hot"]').value||'—'
  }));
}

function indicatorsMean(){
  const mats = state.depts.map(d=>d.values);
  const mean = idx => mats.map(a=>a[idx]).reduce((x,y)=>x+y,0)/mats.length;
  return {stable:mean(0),res:mean(1),social:mean(2),focus:mean(3)};
}

function render(){
  $('#kpis').innerHTML = kpiHTML([
    {l:"場次",v:String(state.kpi.sessions)},
    {l:"學員數",v:String(state.kpi.learners)},
    {l:"平均 Δ",v:state.kpi.avgDelta},
    {l:"平均 NPS",v:state.kpi.avgNPS}
  ]);

  const rows = state.depts.map(d=>`<tr><td>${esc(d.name)}</td><td>+${avg(d.values).toFixed(1)}</td><td>${esc(d.hot||'—')}</td></tr>`).join('');
  $('#tbl').innerHTML = `<tr><th>部門</th><th>平均 Δ</th><th>熱門行動</th></tr>${rows}
  <tr><td colspan="3"><b>建議處方：</b>${listHTML(state.suggestions)}</td></tr>`;

  // 雷達
  const labels1=["穩定度","壓力復原","社會連結","專注力"];
  const ds1 = state.depts.map((d,i)=>({label:d.name||`部門${i+1}`,color:pickColor(i),values:d.values,fill:.12}));
  state.exports.radar1 = Common.drawRadar($('#radar1'),labels1,ds1,{padding:70});
  $('#legend1').innerHTML = legendHTML(ds1);

  const em = indicatorsToPlutchik(indicatorsMean());
  const ds2=[{label:"情緒強度",color:"#7aa6ff",values:Object.values(em),fill:.18}];
  state.exports.radar2 = Common.drawRadar($('#radar2'),Object.keys(em),ds2,{padding:80});
  $('#legend2').innerHTML = legendHTML(ds2);
}

$('#apply').addEventListener('click', ()=>{
  state.brand.company=$('#company').value||state.brand.company;
  state.brand.project=$('#project').value||'';
  state.brand.date=$('#rdate').value||'';
  state.brand.logoUrl=$('#logoUrl').value||'';
  state.brand.color=$('#brandColor').value||state.brand.color;
  state.brand.contact=$('#contactEmail').value||state.brand.contact;
  document.documentElement.style.setProperty('--brand', state.brand.color);
  $('#brandName').textContent = state.brand.company; $('#footBrand').textContent = state.brand.company;

  state.kpi.sessions=parseInt($('#sessions').value||state.kpi.sessions,10);
  state.kpi.learners=parseInt($('#learners').value||state.kpi.learners,10);
  state.kpi.avgDelta=$('#avgDelta').value||state.kpi.avgDelta;
  state.kpi.avgNPS=$('#avgNPS').value||state.kpi.avgNPS;
  captureDeptRows();
  state.suggestions = parseLines($('#suggestions').value);
  render();
});

$('#deptCount').addEventListener('change', ()=> buildDeptRows());
$('#print').addEventListener('click', ()=>{
  const opts = {
    suggestionsHTML: listHTML(state.suggestions),
    radarPNGs:[ state.exports.radar1?.toPNG(2.0), state.exports.radar2?.toPNG(2.0) ],
    legends:[ $('#legend1').innerHTML, $('#legend2').innerHTML ]
  };
  Common.printNow('pro', state.brand, $('#kpis').innerHTML, $('#tbl_title').textContent, $('#tbl').outerHTML, opts);
});

document.addEventListener('DOMContentLoaded', ()=>{
  $('#rdate').value = new Date().toISOString().slice(0,10);
  buildDeptRows(); render();
});
</script>
</body></html>

